---
title   : "以太坊工作原理与基础 - 2 - 区块链2.0 : 以太坊应用开发指南"
---

第二章 以太坊工作原理与基础
=======================

以太坊不仅结合了区块链 1.0 的特性和技术，同时也引入了许多新的改进和其自身独有的创新。

特别是以太坊引入了支持图灵完备的智能合约，使区块链的适用范畴得到了很大的扩展，
并因此推动区块链成为一个能支持各类社会关系在互联网中映射和实现这些社会关系智能化的技术基础设施。

## 2.1 以太坊工作原理

以太坊要在互联网世界中把原来对人的信任转变为对数学原理、对技术和对机器的信任，
这是通过一套清晰、严谨而又复杂的技术体系实现的。

### 2.1.1 以太坊基本术语

术语 | 名称 | 说明
-|-|-
Block | 区块 | 由区块头和区块体构成，区块头包括区块描述信息、上一区块的散列值、时间戳等，区块体保存该时间段的交易列表数据。
Blockchain | 区块链 | 区块之间通过区块头保存上一区块的散列值，使整个网络的区块数据构成了一个不易篡改的链式数据库。
Account | 账户 | 以太坊网络的基础工作单元，包括用户账户 ( EOA ) 和合约账户 ( COA ) 。用户账户由私钥控制；合约账户由其合约代码控制，并且仅能由用户账户触发。
Transaction | 交易 | 区块链数据记录的基本单元，每次转账行为、创建智能合约、调用智能合约均构成一个交易，交易需要消耗燃料。
POW | 工作量证明 | 区块链主要采用的一种共识机制。工作量证明的运行规则为：通过挖矿节点计算数学问题，最先算出的节点获得新区块封装权（即记账权），挖矿成功（即成功封装区块）的节点将获得一定量的虚拟币作为奖励，获得新区块封装权的概率主要取决于挖矿节点在网络中的算力占比。
POS | 权益证明 | 以太坊使用的一种新的共识机制，不由算力来决定记账权，而由节点账户在网络中预先分配的权益大小来决定新区块封装的概率。
Smart Contract | 智能合约 | 一段可以由以太坊虚拟机解析执行的代码，创建时被存储于区块链上并获得一个合约账户（地址）。执行时向该账户发送一个交易（即调用该合约，交易中包含有运行合约需要消耗的燃料及输入数据），由以太坊虚拟机调用合约代码执行。
Ether | 以太币 | 以太坊网络的基础加密数字货币。以太币是以太坊网络的重要应用之一，可用于支持以太坊以智能合约为核心的各类应用的燃料消耗。
Gas | 燃料 | 以太坊提供了可执行图灵完备计算的智能合约，为避免网络资源被随意浪费、恶意滥用或攻击，要求交易发出账户需要为此次交易中所使用的计算资源消耗燃料。

### 2.1.2 以太坊的工作机制

以太坊的重点是通过对智能合约及虚拟机的实现来支撑开放和灵活的各类区块链应用。

以太坊网络中可跟踪每个账户的状态，区块链上的状态改变就是账户之间相关数值和信息的传输。

#### 账户

以太坊网络中包括两类账户：用户账户和合约账户。

- 自然人用户控制用户账户，他们拥有能够控制用户账户的私钥。
- 合约账户由它们内部的智能合约代码控制。

本质来说，合约代码仍然是由自然人用户所控制，因为合约代码由具有确定地址的用户账户触发，而用户账户是由掌握私钥的自然人控制。

智能合约是指合约账户中的代码程序，当交易消息发送给该账户时可以自动执行。

- 用户账户可以通过在区块链中部署代码创建新的智能合约。
- 合约账户只能在用户账户发出命令后执行相应操作。

合约账户不能自发的执行随机数发生器或 API 调用等操作，只能在用户账户的触发下操作这些功能。

合约的达成应在部署前就已明确，所以要让以太坊节点用户认同计算结果，就需要严格的保证计算的确定无误。

#### 以太币、矿工

以太坊引入可编程的智能合约，使得以太坊网络可能面临用户无休止循环执行智能合约代码，
从而造成网络计算资源巨大浪费并最终崩溃。以太坊通过交易有偿计算来解决这个问题。

消耗的以太币由验证网络节点所收取，这些验证网络的节点被称为矿工。

矿工在以太坊网络中接收、传播、验证和执行交易。

这些矿工把所接收到的交易（包括很多以太坊网络中的账户状态更新）组成新的区块，
然后相互竞争谁的区块能被加入到区块链中作为下一个区块。

成功加入区块链下一个区块的矿工将获得以太币，
这种激励措施促使矿工把自身的硬件和电力资源投入到以太坊网络中。

### 2.1.3 以太坊软件架构

以太坊的客户端按照数据层、网络层、共识层、激励层、合约层、应用层等六层构建。

以太坊的矿工 ( Miner ) 在一个分布式的网络中进行挖矿操作，就是实现 POW/POS 的一个共识算法过程。

网络的同步 ( Sync ) 是指各矿工共识过程的同步，共识后产生的新区块链形成的最新账本也需要通过同步模块在各节点间实现数据同步。

每产生一个新的区块，就需要通过共识过程对区块进行验证 ( Block Validator ) ，即需要进行散列计算、验证、签名、定序等。

以太坊平台上的各种去中心化应用，需要编写并部署智能合约代码。

智能合约代码通过 EVM 调用和解析执行，处理区块链与共识的相关事务，
同时基于 RPC 协议进行挖矿和网络层事务的交互，从而实现各种交易的具体应用。

> RPC ( Remote Procedure Call 远程过程调用 ) 协议是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。


## 2.2 以太坊客户端与网络

以太坊客户端既是客户端也是服务器，无数个对等的客户端组成以太坊网络。

客户端既直接面向客户提供各种接口的相互操作，又与网络中的其他客户端形成 P2P 网络，
实现区块链的数据同步、执行共识机制、参与挖矿等。

### 2.2.1 各类以太坊客户端

目前以太坊支持的客户端主要有：

- [go-ethereum](https://geth.ethereum.org/) ( geth )
- [parity](https://github.com/paritytech/parity-ethereum)
- [trinity](https://trinity.ethereum.org/)
- [aleth](https://github.com/ethereum/aleth)

Client | GitHub Repo | Language
-|-|-
[geth] | [go-ethereum] | Go

[geth]: <https://geth.ethereum.org/>
[go-ethereum]: <https://github.com/ethereum/go-ethereum>
