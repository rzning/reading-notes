---
title   : "第一章 引言 - 区块链从概念到实战"
---

第一章 引言
=========

> 以正确的策略使用的技术、时间和空间一起改变了世界。

正如专家们所言，区块链是自互联网发明以来最吸引人和具有颠覆性的发明。

至 2018 年 1 月，全球约有 115 家超过 2000 名员工的初创公司在积极地开发区块链技术平台，
这些平台涉及金融、保险、旅游和供应链等不同领域。

## 历史背景简述

区块链主要与加密数字货币和金融行业相关。

根据 “商业内幕” 最近的报告显示，当前全世界的货币总额是 83.6 万亿元美元，
加密数字货币市场的总金额接近于 7600 亿美元，其中比特币就占了 1300 亿美元。

2018 年 10 月，中本聪 ( Satoshi Nakamoto ) 发表了一篇文章，名叫《比特币：一种点对点的电子现金系统》。
在这篇文章中，他向人们推介了以比特币为形态的数字/加密数字货币。同时，他也提出了区块链作为支持的技术构想。
在这之后的一年当中，中本聪在市场上发布了最初版本的比特币，并首次应用了区块链技术。
它被称为 “创世区块” ( Genesis Block ) ，在 2009 年 1 月 3 日被添加到了区块链网络上。

2009 年 1 月 12 日，比特币完成了第一笔交易。

比特币不仅仅是市场上第一个加密数字货币，更是迄今为止区块链技术框架的第一次应用。
正如许多专家所说的那样，比特币是自互联网被发明以来最具颠覆性的发明。

2010 年，中本聪逐渐淡出并将项目移交给比特币社区的其他成员。

今天的市场上有超过几千种不同的加密数字货币，可以访问下面网址查看：

- <http://coinmarketcap.com/all/views/all/>

市场上的大多数数字货币仍然以区块链为实施框架。区块链正在被更多的行业所采用，像野火一样逐渐蔓延开来。

## 为什么加密数字货币一触即发

自 20 世纪 80 年代以来，好多人已经开发了数字货币或电子货币，但由于技术或监管的原因，许多开发者都失败了。
只有诸如 PayPal, eCash, WebMoney, Liberty Reserve, Payoneer, cashU 等公司取得了成功，采用的都是权力集中的开发模式。

因此权力相对分散的加密数字货币一出现，便引起了人们的关注，加密数字货币具有一下优点：

- 普遍接受；
- 低交易费；
- 防诈欺；
- 即时结算；
- 防止身份被窃。

这要感谢区块链加密技术背后的去中心化的结构框架。

## 了解区块链

区块链的七个基本特性：

- 一个分布式的账本或登记簿。有些人称之为特殊类型的数据库，也可以把它看成一个登记簿；
- 它可以是公共的，也可以是私人的；
- 网络中的每个节点都带有账本的副本；
- 没有单点故障，没有停机时间；
- 区块链中的数据是不可篡改的，一旦存储就不可篡改；
- 数据库中的每个记录都被称为一个区块，并指向链中的上一个区块；
- 每个新的区块都包含一组事务，这些事务被添加到区块链的末尾。

### 为什么选择区块链

区块链是通过比特币而为人所知的，它是一种加密数字货币，概念上是用来解决传统数据库无法满足数字货币需求问题的：

- 区块链账本中的数据不可篡改；
- 这是一个高度安全的数据库，它使用公钥和密钥进行事务处理；
- 数据库公开面向所有人，可用于验证和添加事务；
- 由于区块链权力分散，所以没有停机时间，因此交易可以随时随地添加；
- 它可以是公共或私人的，并灵活地满足个人商业需求；
- 随时都可以接受审计。

### 区块链如何工作

接下来将了解如何将数据添加到区块链账本中。

顾名思义，区块链是一种块链式数据结构，每个区块指向前一个区块。

每个区块包括：

- 1) 一个区块头；
- 2) 区块中的一个或多个事务；
- 3) 一系列的 Ommers 或是叔区块，叔区块的父区块和当前区块的父区块是相同的。

Ommers 是未被选择用于包含在一致性链区块链中的分散区块。然而，矿工仍然可以通过它们挖掘少量的通证。

### 区块头

区块链是由一系列用特定逻辑而连接起来的区块组成的。每个区块都有一个头部，它具有一下信息：

- 1) 前一区块的哈希值；
- 2) 时间戳；
- 3) 挖掘或难度目标；
- 4) 工作量证明 ( PoW ) 的随机数；
- 5) 包含该事务的梅克尔根 ( Merkle root ) 的哈希值。

### 梅克尔根

在实际生活中，区块链更为复杂，每个区块可能包含很多项事务。每个事务都有一个与之关联的哈希值。
因此区块链被指定为哈希值，该哈希值是所有交易的哈希值，即区块的哈希值实际上是哈希值的哈希值，并且被保存在区块头中。
整个金字塔被称为矿工验证的梅克尔根。

如果改变了任何事务，梅克尔根值就会改变对一组交易完整性的验证。

正如比特币杂志 《Bitcoin Magazine》 和以太坊 ( Ethereum ) 的联合创始人 Vitalik Buterin 所说的那样：

> 梅克尔树是组成区块链的一个基本部分。虽然在理论上，确实存在在缺少梅克尔树的情况下建立区块链的可能性，
> 但如果仅仅通过创建直接包含每个交易的巨型区块，那样从长远来看会在使用最强计算机时消弱区块链的可信性，
> 这会给扩展性带来巨大的挑战。

运用这些信息，可以计算当前区块的哈希值，并存储在当前区块和下一个区块中。

接下来用 Java 当然也可以用任何自己喜欢的编程语言来创建一个区块链模型。

## 开始

现在通过一些实际的编程例子来介绍整个区块链的运作模式。

下面将介绍 Java 的三个类定义：

- `Block.java`
- `BlockChain.java`
- `BlockChainClient.java`

可以将 `Block.java` 视为区块链中的区块，它具有交易信息和时间戳等常规数据。

`BlockChain.java` 由一个数组或可扩展数组组成，用户可以在其中添加区块。
默认情况下，当区块链类被实例化时，创世区块已经存在了。

人们可以从 `BlockChainClient` 里进一步向 `BlockChain` 添加更多的区块。

这是一个非常简单的例子。人们在每个区块中只使用了一个事务。
然而，在实际生活中，区块中可能有许多这样的事务，并且区块哈希值是由该区块所有事务的联合哈希值计算出来的。

```java
package com.java.blockChain;
import java.security.MessageDigest;
import javax.xml.bind.DatatypeConverter;

public class Block {
    private int index;
    private String dateTimeStampOfTransaction;
    private String transactionDetails;
    private String previousHash;
    private String hash;
    private int nonce;

    public Block (int index, String date, String transaction, String previousHash, int nonce) {
        this.index = index;
        this.dateTimeStampOfTransaction = date;
        this.transactionDetails = transaction;
        this.previousHash = previousHash;
        this.nonce = nonce;
        this.hash = calculateHash();
    }

    public String calculateHash () {
        // ...
    }
}
```

## 挖矿

挖矿是将交易记录添加到区块链网络的验证过程，在这一过程中人们也会与网络的其余部分进行确认，看结果是否相同。
挖矿被故意设计成计算资源密集型，挖矿过程极其困难，因此矿工每天发现的区块数量是固定的。
这种设计还能控制垃圾邮件，减少它们带来的攻击。挖矿有两个目的：

- 1) 核实交易的合法性，或避免出现所谓的双重支付。
- 2) 通过奖励矿工先前的劳动来创造新的加密数字货币。

挖矿可以通过不同的模型或机制来实现。工作量证明 ( Proof of Work, PoW ) 是比特币推出时的最初模型。

### 工作量证明

在上面简单示例程序中，可以看到向现有的区块链添加一个区块是多么容易。
在 1min 内，人们可以通过这样的程序将数千个区块添加到网络中。
为了最小化这一点，一个被称为 “工作量证明” 的挖掘机制被添加到系统中来，它使整个设计没有垃圾，并且控制区块验证的时间。
单个块只有在经过工作量证明验证后，才能被认为是有效的。

这一工作量的证明是有其他比特币节点每次收到一个区块来验证的。
比特币使用 Hashcash 工作量证明进行验证。

- 交易被捆绑在一起，称之为区块；
- 矿工验证每个区块内的交易是否是合法的；
- 为此，矿工应该解决一个称为工作量证明问题的数学难题；
- 给予第一个解决区块问题的矿工加密数字货币奖励；
- 验证后的交易将被存储在公链中。

当矿工最终找到正确的解决方案时，要及时向整个网络宣布，将会接收到协议提供的加密数字货币奖励。

随着难度级别的增加，矿工们会使用越来越多的高性能机器来试图计算出哈希值的正确结果以决出胜负。

目前比特币区块链每增加一个区块用时大约为 10min ( 2017 年 ) 。

### 关于工作量证明的共识

一旦出现了新的交易，这个消息就会被广播到所有节点，同时挖矿节点就会开始工作以解决难题。
第一个解开的人就会接着把消息广播给其他人。节点只会接受有效的初始交易。
只有当所有节点接受它的最小百分比时，这个交易才会被确认并添加到区块链中。

与世界上的民主投票模式一样，比特币最初的比例是 51% 。
但是如观察到比特币网络中超过 51% 的计算能力掌握在少数矿工手里，人们很快就会将这一标准提高，即超过 51% 。
Pipple ( 另一个区块链框架 ) 现在使用的是 80% 的共识模型。

## DApps

通过上述，已经明白了将数据或承载交易信息的区块添加到区块链中的模式，但这还不是全部。
区块链在分布式模式下工作，该技术被称为 DApps ( 分布式应用程序 ) 或去中心化应用。

它是在网络上实现的，在这个网络中，每个节点都保留区块链的全部或部分副本，
这根除了单点故障影响到交易的可能性，并提高了交易的透明度。

### 完整节点与部分节点

区块链账本的完整账本通常由矿工或验证交易的用户保存，而交易人只拥有一份账本的部分副本。

## 一个关于成功的故事

在过去的 7~8 年，比特币的价格实现了惊人的增长。在 2017 年 10 月一个比特币相当于 5664.84 美元。
在比特币出现之后，许多加密数字货币快速出现，著名的有以太币、瑞波币、莱特币、萌奈币、达世币等。

截至 2017 年，市场上已经超过一千种加密数字货币。
以日本、澳大利亚、瑞典为例，许多国家已经将加密数字货币作为合法交易货币，或已经开始认真思考这个问题。

## 公钥和私钥在区块链中的应用

虽然区块链是一个公共网络，但并不意味着在公共网络上发生的任何交易都应该是公开可见的。
为了做到这一点，人们引入了公钥和私钥。私钥是用自己保存的密钥。

公钥是从私钥中派生出来的，这是大家都知道的。
~~由一个密钥加密的任何数据都可以被另一个密钥解密。~~

假设汤姆希望支付给哈里 200 美元，他将用哈里的公钥加密这次交易，哈里只能用自己的私钥解密它。

## 钱包

加密数字货币的钱包是以数字方式作为形式存储在用户的公钥或私钥中的，编程语言会帮助用户传递和接收加密数字货币。

## 威胁与挑战

### “双重” 花费

不同于实体现金，加密数字货币可以在很短的时间里被消费两次。

为了避免这种情况的发生，区块链会给每一笔交易盖上一个时间戳。
如果发送者想恢复第一次交易并实现再次发送，他需要篡改区块链数据来改变整个链，
但由于存储是通过哈希值的形式保存的，这种篡改是完全不可能实现的。

### DoS 攻击

DoS 攻击是指向区块链网络中发送长度巨大的伪区块的恶意攻击形式。
因为矿工需要大量的时间来评估区块，所以这种攻击会降低网络添加新区块的交易速率。

这主要的原因有两点：

- 1) 区块链是公开的，任何人都可以访问；
- 2) 对于区块的大小没有最大限制。

有许多机制试图解决第二点。比如，一些区块链参与者已经将一种叫作 Segwit 的技术应用到了现有区块链上。
还有一些人已经建立了一个需要授权访问的区块链，只有那些被授权的人才能进行访问。

### 51% 攻击

每一个框架总会有设计上的缺陷，区块链也不例外。
在公链中，如果矿工有 51% 的哈希算力，那么他就可以操纵账本。
但在现实中，这几乎是不可能的，因为每一笔交易都要花费一定的成本，黑客入侵的成本要比利润多。

## 区块链中的分叉

如果使用以太坊作为区块链框架，则很肯能会遇到分叉。

分叉有软分叉和硬分叉两种类型。

### 软分叉

在矿工的工作和分布式共识的作用下，最终新的交易被添加到了区块和区块链网络中，
在这个过程中人们需要确保每个人都是用相同版本的区块链。

当人们使用不同版本的区块链时，系统会创建一个临时的分叉，但是它的故障块会很快被清除掉。
这种分叉就叫作软分叉。

### 硬分叉

然而久而久之软件需要进行改变、升级。因此这两个不同版本的区块链应运而生，
它们有共同的起源，通常称为硬分叉。

分叉可以是软分叉或硬分叉，这取决于原始版本的变化程度。

---

区块链的起源与加密数字货币 ( 比特币 ) 息息相关。

## 读者需要区块链吗

区块链可能是一个全新的世界框架，但它并不能解决所有的存储需求。

### 当使用 RDBMS 时

当符合一下情况时，人们倾向于用传统的数据库：

- 只有一份参与者或组织的数据时；
- 可以通过单点访问控制对数据进行验证时；
- 没有欺诈问题。

### 哪里可以使用公有链

当数据不是私有时，例如一些反馈数据或要广播的数据。
比特币和 Ether 等加密数字货币是最好的例子，投票制度也属于这一类。

### 在哪里使用私人 / 需要权限进入的区块链

金融机构和银行一方面之前存在这多方大量的数据交换行为，另一方面只希望与内部人士分享这些数据，
在这种情况人们会使用私有链。

此外，如果在工作流中需要控制权限，那么基于私有和权限的区块链框架会是正确的选择。
